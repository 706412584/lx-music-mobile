# LX Music Mobile - 功能改造任务

## 任务概述
参考 MusicFree 项目，改造主页布局和完善下载功能

## 任务列表

### 一、主页布局改造

#### 1. 顶部搜索栏
- [ ] 创建搜索栏组件
- [ ] 实现搜索功能
- [ ] 添加搜索历史
- [ ] 样式适配

#### 2. 快捷入口
- [ ] 创建快捷入口组件 (ActionButton)
- [ ] 实现四个入口：
  - [ ] 推荐歌单
  - [ ] 榜单
  - [ ] 播放历史
  - [ ] 本地音乐
- [ ] 图标和样式设计
- [ ] 点击跳转功能

#### 3. 标签页切换
- [ ] 创建标签页组件
- [ ] 实现两个标签：
  - [ ] 我的歌单
  - [ ] 收藏歌单
- [ ] 标签切换动画
- [ ] 选中状态样式

#### 4. 歌单列表展示
- [ ] 优化歌单列表布局
- [ ] 添加歌单封面显示
- [ ] 显示歌曲数量
- [ ] 添加删除/取消收藏功能
- [ ] 长按菜单功能
- [ ] 空状态展示

#### 5. 整体布局调整
- [ ] 调整 Home 组件结构
- [ ] 适配竖屏布局
- [ ] 适配横屏布局
- [ ] 响应式设计

### 二、下载功能完善

#### 1. 下载队列管理
- [ ] 参考 MusicFree 的 downloader 核心
- [ ] 实现下载队列
- [ ] 支持并发下载控制
- [ ] 下载任务持久化

#### 2. 下载状态管理
- [ ] 实现状态枚举：
  - [ ] Pending (等待中)
  - [ ] Preparing (准备中)
  - [ ] Downloading (下载中)
  - [ ] Completed (已完成)
  - [ ] Error (失败)
- [ ] 状态切换逻辑
- [ ] 状态持久化

#### 3. 下载进度显示
- [ ] 实时更新下载进度
- [ ] 显示已下载大小
- [ ] 显示总文件大小
- [ ] 显示下载速度
- [ ] 进度条组件

#### 4. 错误处理
- [ ] 定义错误类型：
  - [ ] NoWritePermission (无写入权限)
  - [ ] FailToFetchSource (获取源失败)
  - [ ] NetworkError (网络错误)
  - [ ] Unknown (未知错误)
- [ ] 错误提示
- [ ] 重试机制

#### 5. 下载页面 UI
- [ ] 参考 MusicFree 的下载列表
- [ ] 显示下载任务列表
- [ ] 任务项状态展示
- [ ] 操作按钮（暂停/继续/删除）
- [ ] 空状态展示
- [ ] 下载完成提示

#### 6. 下载功能集成
- [ ] 在歌曲菜单添加下载选项
- [ ] 支持批量下载
- [ ] 下载音质选择
- [ ] 文件命名规则
- [ ] 存储路径设置

### 三、代码优化

#### 1. 修复现有问题
- [ ] 修复 download store 导入问题
- [ ] 修复 nanoid 依赖问题
- [ ] 修复文件系统 API 调用
- [ ] 修复状态管理问题

#### 2. 类型定义
- [ ] 完善 TypeScript 类型
- [ ] 添加接口文档注释
- [ ] 类型安全检查

#### 3. 性能优化
- [ ] 列表渲染优化
- [ ] 图片加载优化
- [ ] 内存管理优化

### 四、测试

#### 1. 功能测试
- [ ] 主页布局测试
- [ ] 搜索功能测试
- [ ] 下载功能测试
- [ ] 各种状态测试

#### 2. 兼容性测试
- [ ] Android 不同版本测试
- [ ] 不同屏幕尺寸测试
- [ ] 横竖屏切换测试

## 参考文件

### MusicFree 参考文件
- `MusicFree-master/src/pages/home/` - 主页实现
- `MusicFree-master/src/pages/downloading/` - 下载页面
- `MusicFree-master/src/core/downloader/` - 下载核心
- `MusicFree-master/src/components/base/` - 基础组件

### 当前项目文件
- `src/screens/Home/` - 主页
- `src/screens/Home/Views/Download/` - 下载页面
- `src/core/download/` - 下载核心
- `src/store/download/` - 下载状态管理
- `src/components/OnlineList/` - 在线列表组件

## 实施计划

### 第一阶段：修复现有问题（1天）
1. 修复 download 功能的导入和依赖问题
2. 确保基础下载功能可用
3. 测试基本下载流程

### 第二阶段：完善下载功能（2-3天）
1. 参考 MusicFree 实现下载队列
2. 完善状态管理和进度显示
3. 优化下载页面 UI
4. 添加错误处理和重试机制

### 第三阶段：改造主页布局（2-3天）
1. 实现顶部搜索栏
2. 创建快捷入口组件
3. 实现标签页切换
4. 优化歌单列表展示
5. 整体布局调整和适配

### 第四阶段：测试和优化（1-2天）
1. 功能测试
2. 性能优化
3. Bug 修复
4. 文档更新

## 注意事项

1. 保持代码风格一致
2. 遵循项目现有的架构模式
3. 注意 TypeScript 类型安全
4. 做好错误处理和边界情况
5. 及时提交代码，保持小步提交
6. 添加必要的注释和文档
